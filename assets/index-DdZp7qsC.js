(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();async function y(t){const r={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1440}},audio:!1};try{const e=await navigator.mediaDevices.getUserMedia(r);return t.srcObject=e,await new Promise(o=>{t.onloadedmetadata=()=>{t.play(),o()}}),e}catch(e){if(e.name==="OverconstrainedError"){const o=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});return t.srcObject=o,await new Promise(n=>{t.onloadedmetadata=()=>{t.play(),n()}}),o}throw e}}async function C(t,r){const e=r.getContext("2d");return r.width=t.videoWidth,r.height=t.videoHeight,e.drawImage(t,0,0),new Promise((o,n)=>{r.toBlob(a=>{a?o(a):n(new Error("Failed to create image blob"))},"image/jpeg",.85)})}const E="modulepreload",S=function(t){return"/ocr_invoice_upload/"+t},v={},k=function(r,e,o){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),s=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));n=Promise.allSettled(e.map(l=>{if(l=S(l),l in v)return;v[l]=!0;const f=l.endsWith(".css"),w=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${w}`))return;const d=document.createElement("link");if(d.rel=f?"stylesheet":E,f||(d.as="script"),d.crossOrigin="",d.href=l,s&&d.setAttribute("nonce",s),document.head.appendChild(d),f)return new Promise((b,L)=>{d.addEventListener("load",b),d.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return n.then(i=>{for(const s of i||[])s.status==="rejected"&&a(s.reason);return r().catch(a)})};let u=null;async function P(){if(u)return u;const{createWorker:t}=await k(async()=>{const{createWorker:r}=await import("./index-BZH6TDpT.js").then(e=>e.i);return{createWorker:r}},[]);return u=await t("jpn",1,{logger:r=>{r.status==="recognizing text"&&r.progress&&window.ocrProgressCallback&&window.ocrProgressCallback(r.progress)}}),u}async function x(t,r){window.ocrProgressCallback=r;try{r(0);const e=await P(),o=await O(t),{data:{text:n}}=await e.recognize(o);return r(1),n}catch(e){throw console.error("OCR error:",e),new Error("OCR処理に失敗しました")}finally{delete window.ocrProgressCallback}}function B(t){const r=[],e=[],o=t.split(`
`);for(const a of o){const i=a.trim();if(!i)continue;const s=$(i);s!==0&&(i.includes("円")||i.includes("¥")?r.includes(s)||r.push(s):e.includes(s)||e.push(s))}r.sort((a,i)=>i-a),e.sort((a,i)=>i-a);const n=[];return n.push(...r.slice(0,3)),n.push(...e.slice(0,3)),n}function $(t){let r="";for(const o of t)if(/\d/.test(o)&&(r+=o),r.length>8)return 0;if(!r)return 0;const e=parseInt(r,10);return e>=101&&e<=999999?e:0}function O(t){return new Promise((r,e)=>{const o=new FileReader;o.onloadend=()=>r(o.result),o.onerror=e,o.readAsDataURL(t)})}window.addEventListener("beforeunload",async()=>{u&&await u.terminate()});async function I(t,r){if(navigator.share&&navigator.canShare){const e={files:[t],title:r,text:"Save to Google Drive"};try{if(navigator.canShare(e))return await navigator.share(e),!0}catch(o){console.log("Share cancelled or failed:",o)}}return j(t,r),!1}function j(t,r){const e=URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download=r,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(e)},100)}function p(t=null,r=null){const e=new Date,o=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");let s=`${o}-${n}-${a}`;return t&&(s+=`_${t}`),r&&(s+=`_${r}`),`${s}.jpg`}function D(t,r){const e=document.createElement("div");e.className="dialog-backdrop",e.innerHTML=`
    <div class="dialog">
      <h3 class="dialog-title">金額を選択してください</h3>
      <div class="dialog-options">
        ${t.map((n,a)=>`
          <button class="dialog-option" data-value="${n}">
            ¥${n.toLocaleString()}
          </button>
        `).join("")}
        <button class="dialog-option" data-value="none">
          上記以外
        </button>
      </div>
    </div>
  `;const o=n=>{if(n.target.classList.contains("dialog-option")){const a=n.target.dataset.value;e.remove(),r(a==="none"?null:a)}};e.addEventListener("click",o),document.body.appendChild(e)}function F(t){const r=[{id:"kaigi",label:"会議"},{id:"kousai",label:"交際"},{id:"koutuuhi",label:"交通費"},{id:"iryou",label:"医療"}],e=document.createElement("div");e.className="dialog-backdrop",e.innerHTML=`
    <div class="dialog">
      <h3 class="dialog-title">項目を選択してください</h3>
      <div class="dialog-options">
        ${r.map(n=>`
          <button class="dialog-option" data-value="${n.id}">
            ${n.label}
          </button>
        `).join("")}
      </div>
    </div>
  `;const o=n=>{if(n.target.classList.contains("dialog-option")){const a=n.target.dataset.value;e.remove(),t(a)}};e.addEventListener("click",o),document.body.appendChild(e)}const c={video:document.getElementById("camera-video"),placeholder:document.getElementById("camera-placeholder"),captureBtn:document.getElementById("capture-btn"),progressContainer:document.getElementById("progress-container"),progressFill:document.getElementById("progress-fill"),progressText:document.getElementById("progress-text"),output:document.getElementById("output"),outputText:document.getElementById("output-text"),error:document.getElementById("error"),canvas:document.getElementById("capture-canvas")};let g=null;async function R(){try{g=await y(c.video),c.placeholder.style.display="none",c.captureBtn.disabled=!1}catch(t){m("カメラへのアクセスが拒否されました。設定を確認してください。"),console.error("Camera init error:",t)}c.captureBtn.addEventListener("click",T),document.addEventListener("visibilitychange",async()=>{if(document.visibilityState==="visible"&&g){const t=g.getVideoTracks();if(t.length===0||t[0].readyState!=="live")try{g=await y(c.video)}catch(r){console.error("Camera recovery failed:",r)}}})}async function T(){try{U(),c.captureBtn.disabled=!0;const t=await C(c.video,c.canvas);c.progressContainer.classList.add("active"),c.output.classList.remove("active");const r=await x(t,o=>{const n=Math.round(o*100);c.progressFill.style.width=`${n}%`,c.progressText.textContent=`${n}%`});if(c.progressContainer.classList.remove("active"),!r||r.trim().length===0){m("テキストを認識できませんでした。");return}c.output.classList.add("active"),c.outputText.textContent=r;const e=B(r);if(e.length===0){const o=p(),n=new File([t],o,{type:"image/jpeg"});await h(n)}else D(e,async o=>{if(o===null){const n=p(),a=new File([t],n,{type:"image/jpeg"});await h(a)}else F(async n=>{const a=p(o,n),i=new File([t],a,{type:"image/jpeg"});await h(i)})})}catch(t){m("処理中にエラーが発生しました: "+t.message),console.error("Capture error:",t)}finally{c.captureBtn.disabled=!1}}async function h(t){await I(t,t.name)||m("共有に失敗しました。手動でダウンロードしてください。")}function m(t){c.error.textContent=t,c.error.classList.add("active")}function U(){c.error.classList.remove("active")}R();
